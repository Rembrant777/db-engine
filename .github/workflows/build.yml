name: CMake

on: [pull_request]

jobs:
  build:
    name: Check on ${{ matrix.os }}
    env:
      boost_version: "1.75.0"
      boost_version_name: "1_75_0"
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [macos-latest]
      
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
      with:
        submodules: recursive
    - name: Install gtest 
      run: |
          echo $(pwd) && 
          wget -nv -O /tmp/googletest-1.13.0.tar.gz https://github.com/google/googletest/archive/refs/tags/v1.13.0.tar.gz && 
          cd /tmp && tar xzf googletest-1.13.0.tar.gz && 
          cd googletest-1.13.0/ && cp -r include/* /usr/local/include/ && ls /usr/local/include/  && 
          mkdir -p ./build && cd build && cmake ../ && make && echo $(pwd) && cd ./lib/ && ls -a && mv *.a /usr/local/lib/ &&
          ls /usr/local/include/gtest/* && ls /usr/local/lib/libgtest* 
          echo "gtest installed ok" 
    - name: Install boost
      run: |
         echo $(pwd) && 
         wget -nv -O /tmp/boost.zip https://boostorg.jfrog.io/artifactory/main/release/${{ env.boost_version }}/source/boost_${{ env.boost_version_name }}.zip && 
         cd /tmp && unzip boost.zip && 
         cd boost_${{ env.boost_version_name }} && ./bootstrap.sh && ./b2 && ./b2 install # install to default path /usr/local/lib, /usr/local/bin
    - name: cmake and build 
      run: |
         echo $(pwd) && sh ./build.sh      
    - name: Test
      run: echo "run test"
